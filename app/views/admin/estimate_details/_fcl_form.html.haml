= f.alert_message flash[:error]
= f.fields_for :estimate, f.object.estimate do |ff|
  = ff.collection_select :customer_id, Customer.order(:email), :id, :full_name, {include_blank: '', append: link_to("...", admin_customers_path, class: "btn btn-info", title: t("activerecord.models.customer", count: 2))}, {:"data-placeholder"=> t("placeholders.estimate.customer_id")}
  = ff.grouped_collection_select :origin_port_id, Country.order(:name), :ports, :name, :id, :name, {include_blank: '', append: link_to("...", admin_ports_path, class: "btn btn-info", title: t("activerecord.models.port", count: 2))}, {:"data-placeholder"=> t("placeholders.estimate.origin_port_id")}
  = ff.grouped_collection_select :destination_port_id, Country.order(:name), :ports, :name, :id, :name, {include_blank: '', append: link_to("...", admin_ports_path, class: "btn btn-info", title: t("activerecord.models.port", count: 2))}, {:"data-placeholder"=> t("placeholders.estimate.destination_port_id")}
= f.static_control :origin, append: link_to("...", "#origin_address_modal", class: "btn btn-info", :role=>"button", :"data-toggle" => "modal"), :id => "origin_address_full_input"
#origin_address_modal.modal.fade
  .modal-dialog.type-info
    .modal-content
      .modal-header
        %button{:type=>"button", :class=>"close", :"data-dismiss"=>"modal", :"aria-hidden"=>"true"} &times;
        %h4.modal-title= t("activerecord.attributes.estimate_detail_fcl.origin")
      .modal-body
        = f.text_field :origin_address, :id => "origin_address_input"
        = f.text_field :origin_city, :id => "origin_city_input"
        = f.text_field :origin_zip, :id => "origin_zip_input"
        = f.collection_select :origin_country_id, Country.order(:name), :id, :name, {include_blank: ''}, {:"data-placeholder"=> t("placeholders.estimate_detail_fcl.origin_country_id"), :id => "origin_country_input"}
      .modal-footer
        %button{:type=>"button", :class=>"btn btn-default", :"data-dismiss"=>"modal"}= t("helpers.close")
        %button{:type=>"button", :class=>"btn btn-success"}= t("helpers.submit.submit")
:javascript
  $(function() {
    $("#origin_address_modal .btn-success").click(function(){
      var country = $('#origin_country_input option:selected').text() 
      $("#origin_address_full_input").html($("#origin_address_input").val()+" "+$("#origin_zip_input").val()+" "+$("#origin_city_input").val()+" ("+country+")")
      $("#origin_address_modal").modal('hide'); 
    })
  })
= f.static_control :destination, append: link_to("...", "#destination_address_modal", class: "btn btn-info", :role=>"button", :"data-toggle" => "modal"), :id => "destination_address_full_input"
#destination_address_modal.modal.fade
  .modal-dialog.type-info
    .modal-content
      .modal-header
        %button{:type=>"button", :class=>"close", :"data-dismiss"=>"modal", :"aria-hidden"=>"true"} &times;
        %h4.modal-title= t("activerecord.attributes.estimate_detail_fcl.destination")
      .modal-body
        = f.text_field :destination_address, :id => "destination_address_input"
        = f.text_field :destination_city, :id => "destination_city_input"
        = f.text_field :destination_zip, :id => "destination_zip_input"
        = f.collection_select :destination_country_id, Country.order(:name), :id, :name, {include_blank: ''}, {:"data-placeholder"=> t("placeholders.estimate_detail_fcl.destination_country_id"), :id => "destination_country_input"}
      .modal-footer
        %button{:type=>"button", :class=>"btn btn-default", :"data-dismiss"=>"modal"}= t("helpers.close")
        %button{:type=>"button", :class=>"btn btn-success"}= t("helpers.submit.submit")
:javascript
  $(function() {
    $("#destination_address_modal .btn-success").click(function(){
      var country = $('#destination_country_input option:selected').text() 
      $("#destination_address_full_input").html($("#destination_address_input").val()+" "+$("#destination_zip_input").val()+" "+$("#destination_city_input").val()+" ("+country+")")
      $("#destination_address_modal").modal('hide'); 
    })
  })

= f.fields_for :estimate, f.object.estimate do |ff|
  = ff.text_field :number_of_items
= f.text_area :description
= f.form_group :shipment_type, label: { text: t("activerecord.attributes.estimate_detail_fcl.shipment_type") } do
  = f.radio_button :shipment_type, "spot", label: t("activerecord.attributes.estimate_detail_fcl.shipment_type_spot"), inline: true, class: "shipment_type", :checked => f.object.shipment_type=='spot'
  = f.radio_button :shipment_type, "regular", label: t("activerecord.attributes.estimate_detail_fcl.shipment_type_regular"), inline: true, class: "shipment_type", :checked => f.object.shipment_type=='regular'
= f.text_field :shipments_per_month, id: "shipments_per_month"
= f.form_group :equipment, label: { text: t("activerecord.attributes.estimate_detail_fcl.equipment") } do
  = f.radio_button :equipment, "20_dv", label: t("activerecord.attributes.estimate_detail_fcl.equipment_20_dv"), inline: true, :checked => f.object.equipment=="20_dv", class: "equipment"
  = f.radio_button :equipment, "20_ot", label: t("activerecord.attributes.estimate_detail_fcl.equipment_20_ot"), inline: true, :checked => f.object.equipment=="20_ot", class: "equipment"
  = f.radio_button :equipment, "20_rf", label: t("activerecord.attributes.estimate_detail_fcl.equipment_20_rf"), inline: true, :checked => f.object.equipment=="20_rf", class: "equipment"
  = f.radio_button :equipment, "20_fr", label: t("activerecord.attributes.estimate_detail_fcl.equipment_20_fr"), inline: true, :checked => f.object.equipment=="20_fr", class: "equipment"
  .clearfix
  = f.radio_button :equipment, "40_dv", label: t("activerecord.attributes.estimate_detail_fcl.equipment_40_dv"), inline: true, :checked => f.object.equipment=="40_dv", class: "equipment"
  = f.radio_button :equipment, "40_hc", label: t("activerecord.attributes.estimate_detail_fcl.equipment_40_hc"), inline: true, :checked => f.object.equipment=="40_hc", class: "equipment"
  = f.radio_button :equipment, "40_ot", label: t("activerecord.attributes.estimate_detail_fcl.equipment_40_ot"), inline: true, :checked => f.object.equipment=="40_ot", class: "equipment"
  = f.radio_button :equipment, "40_rf", label: t("activerecord.attributes.estimate_detail_fcl.equipment_40_rf"), inline: true, :checked => f.object.equipment=="40_rf", class: "equipment"
  = f.radio_button :equipment, "40_fr", label: t("activerecord.attributes.estimate_detail_fcl.equipment_40_fr"), inline: true, :checked => f.object.equipment=="40_fr", class: "equipment"
= f.text_field :temperature, id: "temperature"
= f.form_group :imo, label: { text: t("activerecord.attributes.estimate_detail_fcl.imo") } do
  = f.radio_button :imo, 1, label: t("bool_yes"), inline: true, class: "imo", :checked => f.object.imo
  = f.radio_button :imo, 0, label: t("bool_no"), inline: true, class: "imo", :checked => !f.object.imo
= f.text_field :imo_class, class: "imo_true"
= f.text_field :imo_un, class: "imo_true"

= f.form_group do
  = f.submit

:javascript
  function change_shipment_type() {
    if($(".shipment_type:checked").val()=='regular') $("#shipments_per_month").parents(".form-group").first().show();
    else $("#shipments_per_month").parents(".form-group").first().hide();
  }
  function change_equipment() {
    var v = $(".equipment:checked").val();
    if(v=="20_rf" || v=="40_rf") $("#temperature").parents(".form-group").first().show();
    else $("#temperature").parents(".form-group").first().hide();
  }
  function change_imo() {
    if($(".imo:checked").val()=="1") {
      $(".imo_true").each(function() { $(this).parents(".form-group").first().show(); })
    } else {
      $(".imo_true").each(function() {$(this).parents(".form-group").first().hide();})
    }
  }
  $(document).ready(function() {
    $(".shipment_type").change(change_shipment_type);
    change_shipment_type();
    $(".equipment").change(change_equipment);
    change_equipment();
    $(".imo").change(change_imo);
    change_imo();
  })